<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Web AR Platform</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        #ui-container {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
        }
        .ui-button {
            padding: 10px 20px;
            margin: 5px;
            background-color: #fff;
            border: 1px solid #000;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="ui-container">
        <div class="ui-button" id="arViewButton">Toggle AR View</div>
    </div>
    <div id="arContainer" style="display: none;">
        <a-scene embedded arjs>
            <!-- Dynamic scene elements will be added here -->
        </a-scene>
    </div>
    <div id="3dContainer">
        <a-scene>
            <a-box position="0 1 -3" rotation="0 45 0" color="#4CC3D9"></a-box>
            <a-sphere position="2 1 -3" radius="1.25" color="#EF2D5E"></a-sphere>
            <a-cylinder position="-2 1 -3" radius="0.5" height="1.5" color="#FFC65D"></a-cylinder>
            <a-plane position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
            <a-sky color="#ECECEC"></a-sky>
        </a-scene>
    </div>
    <script>
        const arViewButton = document.getElementById('arViewButton');
        const arContainer = document.getElementById('arContainer');
        const threeDContainer = document.getElementById('3dContainer');
        const sceneElement = document.querySelector('#arContainer a-scene');

        // Fetch and load a scene
        function loadScene(sceneId) {
            fetch(`/scenes/${sceneId}`)
                .then(response => response.json())
                .then(config => {
                    // Clear existing objects
                    while (sceneElement.firstChild) {
                        sceneElement.removeChild(sceneElement.firstChild);
                    }

                    // Add objects to the scene
                    config.objects.forEach(obj => {
                        let entity = document.createElement('a-entity');
                        if (obj.type === 'image-target') {
                            entity.setAttribute('artoolkit', `sourceType: image; sourceUrl: ${obj.src}`);
                        } else if (obj.type === 'surface') {
                            entity.setAttribute('gltf-model', obj.model);
                            entity.setAttribute('position', obj.position);
                            entity.setAttribute('scale', obj.scale);
                        }
                        sceneElement.appendChild(entity);
                    });

                    // Add buttons to the UI
                    const uiContainer = document.getElementById('ui-container');
                    config.buttons.forEach(button => {
                        let btn = document.createElement('div');
                        btn.className = 'ui-button';
                        btn.textContent = button.label;
                        btn.addEventListener('click', () => {
                            if (button.action === 'startAnimation') {
                                startAnimation();
                            }
                        });
                        uiContainer.appendChild(btn);
                    });
                });
        }

        // Function to start an animation
        function startAnimation() {
            let model = document.querySelector('[gltf-model]');
            model.setAttribute('animation', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: 2000
            });
        }

        // Toggle AR view
        arViewButton.addEventListener('click', () => {
            if (arContainer.style.display === 'none') {
                arContainer.style.display = 'block';
                threeDContainer.style.display = 'none';
                loadScene('scene1'); // Load a default scene
            } else {
                arContainer.style.display = 'none';
                threeDContainer.style.display = 'block';
            }
        });

        // Initial 3D view
        document.addEventListener('DOMContentLoaded', () => {
            loadScene('scene1'); // Load a default scene initially
        });
    </script>
</body>
</html>
